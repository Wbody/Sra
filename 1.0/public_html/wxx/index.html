<!DOCTYPE html>
<html>
    <head>
        <title>大屏幕监控</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../lib/Bootstrap/3.3.7/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="../WbodyJS/css/common.css">
        <link rel="stylesheet" href="css/wxx.css">
        <style>
            html{
                font-size: 100px;
            }
            .anchorBL{
                display: none;
            }
            .backgroup{
                position: absolute;
            }
            .chart_number_item{
                font-family: LcdD;
            }
            .Wlayer, .inlineWlayer {
                z-index: 1001;
                background-color: transparent;
            }
        </style>
    </head>
    <body>
        <div class="backgroup">
            <div class="container-fluid">
                <div class="row">
                    <div class="header">
                        <div class="header_item header_l">
                            2017年10月29号，星期日
                        </div>
                        <div class="header_item header_c">
                            台站监控中心
                        </div>
                        <div class="header_item header_r">
                            上午10点28分45秒
                        </div>
                        <div class="clearfix"></div>
                    </div>

                    <div class="body">
                        <div class="body_item body_l">
                            <div class="ybp">
                                <div class="chart_title">
                                    <img src="image/台站.png"/>台站
                                </div>
                                <div class="ybp_item ybp_item_l" id="xysj"></div>
                                <div class="ybp_item ybp_item_c" id="gzwxsj"></div>
                                <div class="ybp_item ybp_item_r" id="gzcxsj"></div>
                                <div class="clearfix"></div>
                            </div>

                            <div class="lcs">
                                <div class="chart_title">
                                    <img src="image/车.png"/>车
                                </div>
                                <div class="chart_label">实时里程数（当月）</div>
                                <div class="chart_number" id="ysslcs">
                                </div>
                                <div class="chart_label">实时里程数（当日）</div>
                                <div class="chart_number" id="rsslcs">
                                </div>
                            </div>

                            <div class="rs">
                                <div class="chart_title">
                                    <img src="image/人.png"/>人
                                </div>
                                <div class="rs_one">
                                    <div class="rs_one_item rs_item_l">当天待命人数</div>
                                    <div class="rs_one_item rs_item_c" id="dtdmrs" ></div>
                                    <div class="rs_one_item rs_item_r">
                                        <span class="rs_item_num" ></span>
                                        <span>个</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="rs_one">
                                    <div class="rs_one_item rs_item_l">未签到人数</div>
                                    <div class="rs_one_item rs_item_c" id="wcdrs" ></div>
                                    <div class="rs_one_item rs_item_r">
                                        <span class="rs_item_num" ></span>
                                        <span>个</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="rs_one">
                                    <div class="rs_one_item rs_item_l">现场作业人数</div>
                                    <div class="rs_one_item rs_item_c" id="xczyrs" ></div>
                                    <div class="rs_one_item rs_item_r">
                                        <span class="rs_item_num" ></span>
                                        <span>个</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="rs_one">
                                    <div class="rs_one_item rs_item_l">在途中人数</div>
                                    <div class="rs_one_item rs_item_c" id="ztzrs" ></div>
                                    <div class="rs_one_item rs_item_r">
                                        <span class="rs_item_num" ></span>
                                        <span>个</span>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <div class="rs_icon">
                                <div class="rs_icon_one">
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/专业保障人员.png"/></div>
                                        <div class="rs_icon_item_label">专业保障人员</div>
                                        <div class="rs_icon_item_num" id="zybzry"></div>
                                    </div>
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/累计巡检.png"/></div>
                                        <div class="rs_icon_item_label">累计巡检</div>
                                        <div class="rs_icon_item_num" id="ljxj"></div>
                                    </div>
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/累计抢修.png"/></div>
                                        <div class="rs_icon_item_label">累计抢修</div>
                                        <div class="rs_icon_item_num"  id="ljqx"></div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                                <div class="rs_icon_one">
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/更换配件.png"/></div>
                                        <div class="rs_icon_item_label">更换配件</div>
                                        <div class="rs_icon_item_num" id="ghpj"></div>
                                    </div>
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/计量检定.png"/></div>
                                        <div class="rs_icon_item_label">计量检定</div>
                                        <div class="rs_icon_item_num" id="jljd"></div>
                                    </div>
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/保障里程.png"/></div>
                                        <div class="rs_icon_item_label">保障里程</div>
                                        <div class="rs_icon_item_num" id="bzlc"></div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>     
                                <div class="rs_icon_one">

                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/培训考试.png"/></div>
                                        <div class="rs_icon_item_label">培训考试</div>
                                        <div class="rs_icon_item_num" id="pxks"></div>
                                    </div>
                                    <div class="rs_icon_item">
                                        <div class="rs_icon_item_img"><img src="image/最快响应.png"/></div>
                                        <div class="rs_icon_item_label">最快响应</div>
                                        <div class="rs_icon_item_num" id="zkxysj"></div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                        <div class="body_item body_c">
                            <div class="map" id="map">

                            </div>
                            <div class="body_c_c">
                                <div class="body_c_c_item body_c_c_l" id="rose" ></div>
                                <div class="body_c_c_item body_c_c_c" id="table" >

                                </div>
                                <div class="body_c_c_item body_c_c_r" >
                                    <div class="gz_icon_one">
                                        <div class="gz_icon_item gzzs">
                                            <div class="gz_icon_item_label">故障台站总数</div>
                                            <div class="gz_icon_item_number">
                                                <span class="bilingbiling">92</span>
                                                <span>个</span>
                                            </div>
                                        </div>
                                        <div class="gz_icon_item ypds">
                                            <div class="gz_icon_item_label ">已派单数</div>
                                            <div class="gz_icon_item_number">
                                                <span class="bilingbiling">92</span>
                                                <span>个</span>
                                            </div>
                                        </div>
                                        <div class="gz_icon_item ybxs">
                                            <div class="gz_icon_item_label ">已报修数</div>
                                            <div class="gz_icon_item_number">
                                                <span class="bilingbiling">92</span>
                                                <span>个</span>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                    <div class="gz_icon_one">
                                        <div class="gz_icon_item wcls">
                                            <div class="gz_icon_item_label">未处理数</div>
                                            <div class="gz_icon_item_number">
                                                <span class="bilingbiling">92</span>
                                                <span>个</span>
                                            </div>
                                        </div>
                                        <div class="gz_icon_item ywcs">
                                            <div class="gz_icon_item_label ">已完成数</div>
                                            <div class="gz_icon_item_number">
                                                <span class="bilingbiling">92</span>
                                                <span>个</span>
                                            </div>
                                        </div>
                                        <div class="gz_icon_item yhls">
                                            <div class="gz_icon_item_label ">已忽略</div>
                                            <div class="gz_icon_item_number">
                                                <span class="bilingbiling">92</span>
                                                <span>个</span>
                                            </div>
                                        </div>
                                        <div class="clearfix"></div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                        <div class="body_item body_r">
                            <div id="form">

                            </div>
                            <div id="picture_box">
                                <div class="picture_box">
                                    <img src="image/demo.png" />
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="timer"></div> 
        <canvas id="canvas"></canvas> 

        <!--下面为接口调用必须引用插件-->
        <script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script>

        <!--下面为接口渲染插件-->
        <script type="text/javascript" src="../WbodyJS/common.js"></script>
        <script type="text/javascript" src="../WbodyJS/EasyAjax.js"></script>
        <script type="text/javascript" src="../WbodyJS/WLayer.js"></script>
        <script type="text/javascript" src="../WbodyJS/Process.js"></script>
        <script type="text/javascript" src="../WbodyJS/WTimer.js"></script>

        <script type="text/javascript" src="../sra/Sra.js"></script>
        <script type="text/javascript" src="../sra/Incubator.js"></script>
        <script type="text/javascript" src="option.js"></script>


        <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=IuStA3X5pxqWDcr5nV0DEaC337Z1hzCg"></script>
        <script type="text/javascript" src="https://cdn.bootcss.com/echarts/3.7.2/echarts.min.js"></script>
        <script type="text/javascript" src=" https://cdn.bootcss.com/echarts/3.7.2/extension/bmap.min.js"></script>
        <script>
            var data = {
                tz: "M1234",
                tzm: "长安站",
                dz: "新世界中心B座",
                bzry: "高以朝",
                cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                fssj: "2017-09:10 09:30:00",
                pdxq: "已派单",
                EMPTY: "NULL"
            };

            var json = [{
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障",
                    pdzt: 1
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障",
                    pdzt: 1
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障"
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障",
                    pdzt: 0
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障"
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障",
                    pdzt: 1
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障",
                    pdzt: 0
                }, {
                    tz: "M1234",
                    tzm: "长安站",
                    cwxx: "雨量:空间一致性判断：错误数据（无降水产生雨量）; ",
                    jcsj: "09:30:00",
                    cwlx: "设备故障",
                    pdzt: 1
                }];


            var username;
            var password;
            var zone;
            var server = "http://192.168.3.100:9017";
            function initParam() {
                username = WUtil.getParameter("username");
                password = WUtil.getParameter("password");
                zone = WUtil.getParameter("zone");
                if (!username) {
                    username = "ad";
                } else {
                    server = "";
                }
                if (!password) {
                    password = "123456";
                }
                if (!zone) {
                    zone = 3;
                }
            }


            var setting = new Object();
            var timer;
            $(document).ready(function () {
                initParam();
                getData();
                setInterval(getData, 10000);
                var table3 = new Plugin("table");
                table3.protocol(["thead", "tbody"], tableSetting3).set("#table", style1).apply(json);

                var table = new Plugin("form");
                table.protocol(["title", "tbody"], tableSetting).set("#form", style).apply(data);

                var table1 = new Plugin("form");
                table1.protocol(["title", "tbody"], tableSetting1).set("#form", style).apply(data);

                var table2 = new Plugin("form");
                table2.protocol(["title", "tbody"], tableSetting2).set("#form", style).apply(data);
                initMap(points);
            });

            var points = [
                {name: '海门', x: 121.15, y: 31.89, sfpd: 0},
                {name: '鄂尔多斯', x: 109.781327, y: 39.608266, sfpd: 1}
            ];

            var dcjax = new EasyAjax();
            function getData() {
                dcjax.set({
                    async: true,
                    dataType: "text",
                    url: server + "/acc/servlet/FuncServlet",
                    params: {
                        clientid: 101,
                        username: username,
                        password: password,
                        requeststr: "&bzdw1=" + zone,
                        repid: 252580,
                        functype: 10
                    },
                    after: function (container, action) {
                        if (action) {
                            $(action).button("reset");
                        }
                        if (!container) {
                            container = "body";
                        }
                        WLayer.qhide(container);
                    },
                    dataDealer: function (data, ext) {
                        if (timer) {
                            clearInterval(timer);
                        }
                        data = JSON.parse(data);
                        data = data.datalist;
                        for (var i  in data) {
                            var item = data[i];
                            var skey = item.skey;
                            setting[skey] = item.svalue;
                        }
                        initRs(setting);
                        initGS(setting);
                        timer = addTimer(function () {
                            setting.dylcs = Number(setting.dylcs) + Math.random() / 10;
                            setting.drlcs = Number(setting.drlcs) + Math.random() / 100;
                            initLCS(setting.dylcs, '#ysslcs');
                            initLCS(setting.drlcs, '#rsslcs');
                        }, 100);

                        initYBP();
                        initRose();
                        return data;
                    }
                }).biu();
            }
            ;

            function initYBP() {
                var fontSize = parseInt($("html").css("font-size"));
                fontSize = fontSize * 0.2;
                var myChart = echarts.init(document.getElementById('xysj'));
                myChart.setOption(getYBP("#0eeed0", "#012a59", 60, "平均响应时间", fontSize));
                myChart = echarts.init(document.getElementById('gzwxsj'));
                myChart.setOption(getYBP("#3db5fa", "#012a59", 50, "平均故障修复时间", fontSize));
                myChart = echarts.init(document.getElementById('gzcxsj'));
                myChart.setOption(getYBP("#9e56f0", "#012a59", 70, "平均故障持续时间", fontSize));
            }

            function initGS(s) {
                $("#zybzry").text(s.zybzry + " 个");
                $("#ljqx").text(s.ljqx + " 个");
                $("#ghpj").text(s.ghpj + " 个");
                $("#ljxj").text(s.ljxj + " 个");
                $("#pxks").text(s.pxks + " 个");
                $("#zkxysj").text(s.zkxysj + " 分");
                $("#jljd").text(s.jljd + " 个");
                $("#bzlc").text(Number(s.bzlc).toFixed(2) + " 里").css("font-size", "0.20rem");
            }

            function initRs(rs) {
                var fontSize = parseInt($("html").css("font-size"));
                var height = fontSize * 0.2;
                var myChart = echarts.init(document.getElementById('dtdmrs'));
                myChart.setOption(getRS(Number(rs.dmrs) / Number(rs.zrs), height));
                $("#dtdmrs").parent().find(".rs_item_num").text(Number(rs.dmrs));
                myChart = echarts.init(document.getElementById('wcdrs'));
                myChart.setOption(getRS(Number(rs.wqdrs) / Number(rs.zrs), height));
                $("#wcdrs").parent().find(".rs_item_num").text(Number(rs.wqdrs));
                myChart = echarts.init(document.getElementById('xczyrs'));
                myChart.setOption(getRS(Number(rs.xczyrs) / Number(rs.zrs), height));
                $("#xczyrs").parent().find(".rs_item_num").text(Number(rs.xczyrs));
                myChart = echarts.init(document.getElementById('ztzrs'));
                myChart.setOption(getRS(Number(rs.tzrs) / Number(rs.zrs), height));
                $("#ztzrs").parent().find(".rs_item_num").text(Number(rs.tzrs));
            }
            function initRose() {
                var fontSize = parseInt($("html").css("font-size"));
                var height = fontSize;
                var myChart = echarts.init(document.getElementById('rose'));
                myChart.setOption(getRose(height));
            }
        </script>
        <script>
            //宇宙特效
            "use strict";
            var fontSize = parseInt($("html").css("font-size"));
            var canvas = document.getElementById('canvas'),
                    ctx = canvas.getContext('2d'),
                    w = canvas.width = 32 * fontSize,
                    h = canvas.height = 18 * fontSize,
                    hue = 217,
                    stars = [],
                    count = 0,
                    maxStars = 1300;//星星数量

            var canvas2 = document.createElement('canvas');
            var ctx2 = canvas2.getContext('2d');
            canvas2.width = 100;
            canvas2.height = 100;
            var half = canvas2.width / 2;
            var gradient2 = ctx2.createRadialGradient(half, half, 0, half, half, half);
            gradient2.addColorStop(0.025, '#CCC');
            gradient2.addColorStop(0.1, 'hsl(' + hue + ', 61%, 33%)');
            gradient2.addColorStop(0.25, 'hsl(' + hue + ', 64%, 6%)');
            gradient2.addColorStop(1, 'transparent');
            ctx2.fillStyle = gradient2;
            ctx2.beginPath();
            ctx2.arc(half, half, half, 0, Math.PI * 2);
            ctx2.fill();
            // End cache
            function random(min, max) {
                if (arguments.length < 2) {
                    max = min;
                    min = 0;
                }

                if (min > max) {
                    var hold = max;
                    max = min;
                    min = hold;
                }

                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            function maxOrbit(x, y) {
                var max = Math.max(x, y),
                        diameter = Math.round(Math.sqrt(max * max + max * max));
                return diameter / 2;
                //星星移动范围，值越大范围越小，
            }

            var Star = function () {
                this.orbitRadius = random(maxOrbit(w, h));
                this.radius = random(60, this.orbitRadius) / 8;
                //星星大小
                this.orbitX = w / 2;
                this.orbitY = h / 2;
                this.timePassed = random(0, maxStars);
                this.speed = random(this.orbitRadius) / 200000;
                //星星移动速度
                this.alpha = random(2, 10) / 10;
                count++;
                stars[count] = this;
            };
            Star.prototype.draw = function () {
                var x = Math.sin(this.timePassed) * this.orbitRadius + this.orbitX,
                        y = Math.cos(this.timePassed) * this.orbitRadius + this.orbitY,
                        twinkle = random(10);

                if (twinkle === 1 && this.alpha > 0) {
                    this.alpha -= 0.05;
                } else if (twinkle === 2 && this.alpha < 1) {
                    this.alpha += 0.05;
                }

                ctx.globalAlpha = this.alpha;
                ctx.drawImage(canvas2, x - this.radius / 2, y - this.radius / 2, this.radius, this.radius);
                this.timePassed += this.speed;
            };

            for (var i = 0; i < maxStars; i++) {
                new Star();
            }

            function animation() {
                ctx.globalCompositeOperation = 'source-over';
                ctx.globalAlpha = 0.5; //尾巴
                ctx.fillStyle = 'hsla(' + hue + ', 64%, 6%, 2)';
                ctx.fillRect(0, 0, w, h);
                ctx.globalCompositeOperation = 'lighter';
                for (var i = 1, l = stars.length; i < l; i++) {
                    stars[i].draw();
                }
                window.requestAnimationFrame(animation);
            }
            animation();
        </script>
    </body>
</html>
